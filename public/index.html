<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nocode API Tester</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f4f9; }
        h1, h2 { color: #2c3e50; }
        .card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, textarea, button { display: block; width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background: #3498db; color: #fff; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background: #2980b9; }
        .response { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 4px; overflow-x: auto; min-height: 50px; white-space: pre-wrap; font-family: monospace; }
        .token-info { font-size: 0.8em; color: #666; word-break: break-all; }
        .method { font-weight: bold; color: #e67e22; }
    </style>
</head>
<body>
    <h1>Nocode API Tester</h1>
    
    <div class="card">
        <h2>1. Authentication</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <div style="display: flex; gap: 10px;">
            <button onclick="apiCall('/api/users/register', 'POST', {email: $('#email').value, password: $('#password').value})">Register</button>
            <button onclick="login()">Login</button>
        </div>
        <div id="token-display" class="token-info">No token stored.</div>
    </div>

    <div class="card">
        <h2>2. Projects</h2>
        <input type="text" id="projectName" placeholder="Project Name">
        <textarea id="projectCode" placeholder="Generated Code (HTML/JS)"></textarea>
        <button onclick="createProject()">Create Project</button>
        <button onclick="apiCall('/api/projects', 'GET', null, true)">List My Projects</button>
    </div>

    <div class="card">
        <h2>Response</h2>
        <div id="response" class="response">Response will appear here...</div>
    </div>

    <script>
        const $ = document.querySelector.bind(document);
        let token = localStorage.getItem('token');
        if(token) $('#token-display').innerText = 'Token: ' + token.substring(0, 50) + '...';

        async function login() {
            const email = $('#email').value;
            const password = $('#password').value;
            const res = await apiCall('/api/users/login', 'POST', {email, password});
            if(res && res.token) {
                token = res.token;
                localStorage.setItem('token', token);
                $('#token-display').innerText = 'Token: ' + token.substring(0, 50) + '...';
            }
        }

        async function createProject() {
            const project_name = $('#projectName').value;
            const generated_code = $('#projectCode').value;
            await apiCall('/api/projects', 'POST', {project_name, generated_code}, true);
        }

        async function apiCall(url, method, body, useToken = false) {
            const headers = { 'Content-Type': 'application/json' };
            if(useToken && token) headers['Authorization'] = `Bearer ${token}`;
            
            $('#response').innerText = 'Loading...';
            try {
                const response = await fetch(url, {
                    method,
                    headers,
                    body: body ? JSON.stringify(body) : null
                });
                const data = await response.json();
                $('#response').innerText = JSON.stringify(data, null, 2);
                return data;
            } catch (err) {
                $('#response').innerText = 'Error: ' + err.message;
            }
        }
    </script>
</body>
</html>
